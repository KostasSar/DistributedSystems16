<html >
	<head>
	
		<style>
			.center {
				margin: auto;
				text-align: center;
				width: 40%;
				background-color: lightgray;
				padding: 10px;
			}
		</style>
		<meta charset="UTF-8">
		 <link href = "https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css"
         rel = "stylesheet">
		 
      <script src = "https://code.jquery.com/jquery-1.10.2.js"></script>
      <script src = "https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
		<script>
			function hide(){
				document.getElementById("mydiv").style.display="none";
			}
			function show(){
				document.getElementById("mydiv").style.display="block";
			}
			
			$(document).ready(function(){
				$('#date').datepicker({ dateFormat: 'yy-mm-dd' });
			});
		</script>
	</head>
	<body>
		<center><a href="./welcome.html"><img src="http://i.imgur.com/OHwYqb6.png" alt="Carecycle's logo icon"></a>
        <div class="center" >
			<form action="ExternalCarServlet" method="post">
				<h5>Vehicle condition:</h5>
				<input type="radio" name="condition" value="Good" checked> Good
				<input type="radio" name="condition" value="Mediocre"> Mediocre
				<input type="radio" name="condition" value="Bad"> Bad
				
				<h5>Need a pickup?</h5>
					<input type="radio" name="form" id="no" value="no" onclick="hide()"/>No<br>
					<input type="radio" name="form" id="yes" value="yes" onclick="show()"/>Yes<br>
				<h5>Find the closest department</h5>
					<input type="hidden" name="Cost" id="transportCost"> 
					<input type="hidden" name="Distance" id="transportDistance">
					<div id ="mydiv" style="display:none">
						<input type="text" id="city"  value="Ελικώνος 9" />
						<input type="button" onclick="findDistance()" value="Get Location" />
						<div id="dvDistance"></div>
						<div id="map" style="width:100%;height:300px"></div>
					</div>
				
				<h5>choose a date </h5>
				<input type="text" id="date">
				<h5>Choose an hour</h5>
				<select>
					<option type = "radio" name="hour" value="9:00">9:00</option>
					<option type = "radio" name="hour" value="10:00">10:00</option>
					<option type = "radio" name="hour" value="11:00">11:00</option><br>
					<option type = "radio" name="hour" value="12:00">12:00</option>
					<option type = "radio" name="hour" value="13:00">13:00</option>
					<option type = "radio" name="hour" value="14:00">14:00</option><br>
					<option type = "radio" name="hour" value="15:00">15:00</option>
					<option type = "radio" name="hour" value="16:00">16:00</option>
				</select>
				
					
				
				<br><button type="Submit">Submit</button>
			</form>
		</div>
    </center>
		
		
		<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
		<script type="text/javascript">
			function findDistance (){
				var directionsService = new google.maps.DirectionsService;
				var directionsDisplay = new google.maps.DirectionsRenderer;
				var previousDistance = 0;
				var previousDuration = 0;
				var ip;
				var counter;
				var cost;
				var stores = ['Βρυαντος 17', 'Βασιλέως Γεωργίου Α και Ηρ. Πολυτεχνείου', 'Ναρκίσου 20', 'Όθωνος Παπαδημητρίου ', 'Μητροπόλεως 9'];
				var address = document.getElementById('city').value;
			
				//instantiate the DirectionsService API
				var directionsService = new google.maps.DirectionsService();
				var check=0;
				var duration;
				var distance;
				//create request object
				
				var mapCanvas = document.getElementById("map");
				var center = new google.maps.LatLng(38 , 23.7);
				var mapOptions = {center,zoom: 12}
				var map = new google.maps.Map(mapCanvas, mapOptions);
				
				for(counter=0; counter<5; counter++){
					var request = {
						origin      : address, // a city, full address, landmark etc
						destination : stores[counter],
						travelMode  : google.maps.DirectionsTravelMode.DRIVING
					};
					directionsService.route(request, function(response, status) {
						if ( status == google.maps.DirectionsStatus.OK ) {
							//response.routes[0].legs[0].distance.value/100 returns the distance in kilometers
							distance = response.routes[0].legs[0].distance.value/1000;
							duration = response.routes[0].legs[0].duration.value;
							if(previousDistance > distance || check == 0){
								previousDistance = distance;
								previousDuration = duration;
								ip = check;
							}
							
						}
						else {
							alert("Unable to find the distance via road.");
						}
						check++;
						if(check==5){
							if( previousDistance <10){
								//alert('20 euro' + stores[ip]);
								cost = 20;
							}
							else if( previousDistance>=10 && previousDistance<=30){
								//alert('30 euro' + stores[ip]);
								cost = 30;
							}else if(previousDistance>=10 && previousDistance<=30){
								//alert('40 euro' + stores[ip]);
								cost = 40;
							}else if( previousDistance>100){
								alert('not possible to transport');
								return;
							}
							
							document.getElementById("transportCost").value = cost;
							document.getElementById("transportDistance").value = duration;
							
							dvDistance.innerHTML= "";
							dvDistance.innerHTML +="Duration is: "+previousDuration+" minutes and Distance is: "+previousDistance+"kmh"+ " the transport will cost you " +cost+ " Euro" ;
							
							var route={
								origin: document.getElementById("city").value,
								destination: stores[ip],
								travelMode: google.maps.TravelMode.DRIVING
							};
					
							directionsService.route(route,function(response,status){
								if(status == google.maps.DirectionsStatus.OK){
									directionsDisplay.setDirections(response);
									directionsDisplay.setMap(map);
								}
								else {
									alert("Could not find driving route");
								}
							});
							var marker;
							var infoWindow = new google.maps.InfoWindow();
							for(check=0;check<=4;check++){
								if(ip ==check){
									continue;
								}
								
								var geocoder = new google.maps.Geocoder();
					     		var address = stores[check];
							
					 			geocoder.geocode({ 'address': address }, function (results, status) {
									if (status == google.maps.GeocoderStatus.OK) {
										var latitude = results[0].geometry.location.lat();
										var longitude = results[0].geometry.location.lng();

										var location = {lat: latitude, lng: longitude};
										marker = new google.maps.Marker({
											position: location,
											map: map
										});
										
										google.maps.event.addListener(marker, 'click', (function(marker, check) {
										return function() {
											infoWindow.setContent(address);
											infoWindow.open(map, marker);
										}
										})(marker, check));
										
									} else {
										alert("could not show rest of the shops.")
									}
									
								});
							}
						}
					});
				}
			}
    </script>
</body>
</html>